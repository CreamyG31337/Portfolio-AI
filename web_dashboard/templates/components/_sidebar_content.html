<!-- Sidebar Navigation - Collapsible with smooth transitions -->
<!-- Mobile: Flowbite drawer (hidden by default, toggled via hamburger) -->
<!-- Desktop: Collapsible sidebar (visible, can be collapsed) -->
<aside id="sidebar"
    class="fixed top-0 left-0 z-40 h-screen bg-dashboard-surface border-r border-border shadow-sm transition-all duration-300 ease-in-out transform -translate-x-full md:translate-x-0"
    aria-label="Sidebar" tabindex="-1" aria-labelledby="sidebar-label">
    <!-- Toggle Button (visible on desktop) -->
    <button id="sidebar-collapse-toggle"
        class="hidden md:flex absolute top-20 right-0 z-50 p-2 bg-dashboard-surface border border-border rounded-l-lg shadow-md hover:bg-dashboard-surface-alt transition-all duration-300 items-center justify-center"
        aria-label="Toggle sidebar">
        <i id="sidebar-toggle-icon"
            class="fas fa-chevron-left text-text-secondary transition-transform duration-300"></i>
    </button>

    <div class="h-full px-3 pb-4 pt-24 overflow-y-auto bg-dashboard-surface transition-all duration-300">
        <div class="mb-4 mt-2 sidebar-content">
            <h2 class="text-lg font-bold text-text-primary px-2 whitespace-nowrap overflow-hidden sidebar-text">
                Navigation</h2>
        </div>

        <!-- Navigation links -->
        <ul class="space-y-1">
            {% if navigation_links %}
            <li>
                <a href="/dashboard" {% if current_page == 'dashboard' %}aria-current="page"{% endif %}
                    class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'dashboard' %}bg-dashboard-surface-alt text-accent{% endif %}">
                    <span class="mr-3 text-lg flex-shrink-0">ğŸ“ˆ</span>
                    <span class="sidebar-text whitespace-nowrap overflow-hidden">Dashboard</span>
                </a>
            </li>
            {% for link in navigation_links %}
            {% if link.show %}
            <li>
                <a href="{{ link.url }}" {% if link.active %}aria-current="page"{% endif %}
                    class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if link.active %}bg-theme-info-bg text-theme-info-text{% endif %}">
                    <span class="mr-3 text-lg flex-shrink-0">{{ link.icon }}</span>
                    <span class="sidebar-text whitespace-nowrap overflow-hidden">{{ link.name }}</span>
                </a>
            </li>
            {% endif %}
            {% endfor %}
            {% else %}
            <li>
                <a href="/"
                    class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt">
                    <span class="mr-3 text-lg flex-shrink-0">ğŸ“ˆ</span>
                    <span class="sidebar-text whitespace-nowrap overflow-hidden">Dashboard</span>
                </a>
            </li>
            {% endif %}
        </ul>

        <!-- Fund Selector (like Streamlit sidebar) -->
        <div class="mt-6 pt-4 border-t border-border sidebar-content">
            <div class="px-3 mb-2">
                <label for="global-fund-select"
                    class="text-xs font-semibold text-text-tertiary uppercase whitespace-nowrap overflow-hidden sidebar-text">
                    ğŸ“Š Data Source
                </label>
            </div>
            <div class="px-2">
                <select id="global-fund-select"
                    class="w-full p-2 text-sm border border-border rounded-lg bg-dashboard-surface text-text-primary focus:ring-2 focus:ring-accent focus:border-accent sidebar-select">
                    {% if allow_all_funds is not defined or allow_all_funds %}
                    <option value="all" {% if not selected_fund or selected_fund=='all' %}selected{% endif %}>
                        All Funds</option>
                    {% endif %}
                    {% if available_funds %}
                    {% for fund in available_funds %}
                    <option value="{{ fund }}" {% if fund==selected_fund %}selected{% endif %}>{{ fund }}
                    </option>
                    {% endfor %}
                    {% else %}
                    <option value="">(No funds available)</option>
                    {% endif %}
                </select>
            </div>
        </div>


        <!-- Admin section (if admin) -->
        {% if is_admin|default(false) %}
        <div class="mt-6 pt-6 border-t border-border sidebar-content">
            <div class="px-3 mb-2">
                <span
                    class="text-xs font-semibold text-text-tertiary uppercase whitespace-nowrap overflow-hidden sidebar-text">Admin</span>
            </div>
            <ul class="space-y-1">
                <li>
                    <a href="/admin/scheduler" {% if current_page == 'admin_scheduler' %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'admin_scheduler' %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ”¨</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">Jobs Scheduler</span>
                        {% if scheduler_status == 'running' %}
                        <span
                            class="inline-flex items-center justify-center px-2 py-1 ms-3 text-xs font-medium text-theme-success-text bg-theme-success-bg rounded-full sidebar-badge">Running</span>
                        {% else %}
                        <span
                            class="inline-flex items-center justify-center px-2 py-1 ms-3 text-xs font-medium text-theme-error-text bg-theme-error-bg rounded-full sidebar-badge">Stopped</span>
                        {% endif %}
                    </a>
                </li>
                <li>
                    <a href="/admin/users" {% if current_page == 'admin_users' %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'admin_users' %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ‘¥</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">User Management</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/contributors" {% if current_page == 'admin_contributors' %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'admin_contributors' %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ‘¤</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">Contributors</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/funds" {% if current_page == 'admin_funds' %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'admin_funds' %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ¦</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">Fund Management</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/trade-entry" {% if current_page == 'admin_trade_entry' %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'admin_trade_entry' %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ“ˆ</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">Trade Entry</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/contributions" {% if current_page == 'admin_contributions' %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'admin_contributions' %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ’°</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">Contributions</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/ai-settings" {% if current_page == 'admin_ai_settings' %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'admin_ai_settings' %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ¤–</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">AI Settings</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/system" {% if current_page == 'admin_system' %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'admin_system' %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ–¥ï¸</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">System Monitor</span>
                    </a>
                </li>
                <li>
                    <a href="/logs" {% if current_page == 'admin_logs' %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page == 'admin_logs' %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ“œ</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">Logs</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('dev_home') }}" {% if current_page in ['dev_home', 'sql_interface'] %}aria-current="page"{% endif %}
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt {% if current_page in ['dev_home', 'sql_interface'] %}bg-dashboard-surface-alt text-accent{% endif %}">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ› ï¸</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">Developer Tools</span>
                    </a>
                </li>
                <li>
                    <a href="/streamlit/" target="_blank"
                        class="flex items-center px-3 py-2 text-sm font-medium text-text-secondary rounded-lg hover:bg-dashboard-surface-alt">
                        <span class="mr-3 text-lg flex-shrink-0">ğŸ”„</span>
                        <span class="sidebar-text flex-1 whitespace-nowrap overflow-hidden">Streamlit (Legacy)</span>
                        <span
                            class="inline-flex items-center justify-center px-2 py-1 ms-3 text-xs font-medium text-theme-warning-text bg-theme-warning-bg rounded-full sidebar-badge">Old</span>
                    </a>
                </li>
            </ul>
        </div>
        {% endif %}
    </div>
</aside>